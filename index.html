<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reminder Notifications</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <p id="title">Reminder Notifications</p>
    <textarea id="primary" placeholder='Title'></textarea>
    <textarea id="secondary" placeholder='Description'></textarea>
    <select id="icons" onchange="icon()">>
        <option value="https://web-push-book.gauntface.com/images/demos/icon-512x512.png">Reminder</option>
        <option value="https://web-push-book.gauntface.com/images/demos/icon-512x512.png">Event</option>
        <option value="https://web-push-book.gauntface.com/images/demos/icon-512x512.png">Call</option>
    </select>
    <button class="btn" onclick="display()">Show Notification</button>
    <p>Current permission status is: <b id="status">...</b></p>
    <script>
        function icon() {
            var e = document.getElementById("icons");
            var strUser = e.options[e.selectedIndex].value;
            return strUser;
        };

        function titleTxt() {
            var newTitle = document.getElementById("primary").value;
            return newTitle;
        };

        function bodyTxt() {
            var bodyTxt = document.getElementById("secondary").value;
            return bodyTxt;
        };

        var $status = document.getElementById('status');

        if ('Notification' in window) {
            $status.innerText = Notification.permission;
        }

        function requestPermission() {
            if (!('Notification' in window)) {
                alert('Notification API not supported!');
                return;
            }

            Notification.requestPermission(function(result) {
                $status.innerText = result;
            });
        }

        function persistentNotification() {
            if (!('Notification' in window) || !('ServiceWorkerRegistration' in window)) {
                alert('Persistent Notification API not supported!');
                return;
            }

            try {
                var title = titleTxt();
                var options = {
                    icon: icon(),
                    body: bodyTxt()
                };
                navigator.serviceWorker.getRegistration()
                    .then(reg => reg.showNotification(title + ' persistent', options))
            } catch (err) {
                alert('Notification API error: ' + err);
            }
        }

        function nonPersistentNotification() {
            try {
                var title = titleTxt();
                var options = {
                    icon: icon(),
                    body: bodyTxt()
                };
                var notification = new Notification(title, options);
            } catch (err) {
                alert('Notification API error: ' + err);
            }
        }

        // Registering ServiceWorker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(function(registration) {
                // Registration was successful
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }).catch(function(err) {
                // registration failed :(
                console.log('ServiceWorker registration failed: ', err);
            });
        }

        function display() {
            requestPermission();
            try {
                persistentNotification();
                console.log(title);
            } catch (err) {
                nonPersistentNotification();
            }
        }
    </script>
</body>

</html>